function YYIMCacheGroup(e){this.build(e)}function YYIMCacheGroupManager(){}function YYIMCacheGroupMember(e){this.build(e)}function YYIMCachePubAccount(e){this.build(e)}function YYIMCachePubAccountManager(){}function YYIMCacheList(){this.list={}}function YYIMCacheMessage(e){this.build(e)}function YYIMCacheMessageManager(){this.messList={}}function YYIMCachePresence(e){this.id=e.id||e.from||this.id,this.presence={},this.build(e)}function YYIMCacheRoster(e){this.build(e)}function YYIMCacheRosterManager(){this.init()}function YYIMCacheVCard(e){this.build(e)}function YYIMCacheRecent(e){this.build(e)}function YYIMCacheRecentManager(){this.recentList=[]}YYIMCacheGroup.prototype=new YYIMCacheList,YYIMCacheGroup.prototype.init=function(){this.syncInfo(),this.updateMemberList()},YYIMCacheGroup.prototype.build=function(e){this.id=e.id||this.id,this.name=e.name||this.name,this.numberOfMembers=e.numberOfMembers||this.numberOfMembers,this.superLarge=e.superLarge||this.superLarge,this.collected=e.collected>0?e.collected:0,this.creater=e.creater||this.creater,this.photo=e.photo||this.photo,this.members=e.members||this.members,this.init()},YYIMCacheGroup.prototype.syncInfo=function(){this.photo||(this.photo=YYIMCacheConfig.DEFAULT_PHOTO.GROUP)},YYIMCacheGroup.prototype.getPhotoUrl=function(){return YYIMChat.getFileUrl(this.photo)},YYIMCacheGroup.prototype.updateMemberList=function(){if(this.members instanceof Array&&this.members.length){this.clear();for(var e=0;e<this.members.length;e++){var t=this.get(this.members[e].id);if(t)try{t.build(this.members[e])}catch(s){console.error(t,this.members[e])}else t=new YYIMCacheGroupMember(this.members[e]),this.set(t.id,t);"owner"===t.affiliation&&(this.owner=t)}this.numberOfMembers=this.members.length,this.members=null}},YYIMCacheGroup.prototype.removeMember=function(e){var t=this.get(e);if(t){this.remove(e);var s=this.numberOfMembers-1;this.numberOfMembers=s>=0?s:0}},YYIMCacheGroup.prototype.transferOwner=function(e){var t=this.get(e);t&&(this.owner.affiliation="member",this.owner=t,this.owner.affiliation="owner")},YYIMCacheGroupManager.prototype=new YYIMCacheList,YYIMCacheGroupManager.getInstance=function(){return this._instance||(this._instance=new YYIMCacheGroupManager),this._instance},YYIMCacheGroupManager.prototype.updateCache=function(e){if(e&&e.id){var t=this.get(e.id);return t?t.build(e):(t=new YYIMCacheGroup(e),this.set(t.id,t)),t}},YYIMCacheGroupManager.prototype.createChatGroup=function(e){var t=this;YYIMChat.createChatGroup({name:e.name,members:e.members||[],success:function(s){t.updateCache(s),e.success&&e.success(s)},complete:function(){e.complete&&e.complete()}})},YYIMCacheGroupManager.prototype.transferChatGroup=function(e){var t=this.get(e.to);if(t.owner&&t.owner.id===YYIMChat.getUserID()){var s=t.get(e.newOwner);if(s){var i=this;YYIMChat.transferChatGroup({to:e.to||e.id,newOwner:e.newOwner,success:function(t){i.transferOwner(e.to,e.newOwner),e.success&&e.success(t)},complete:function(){e.complete&&e.complete()}})}}},YYIMCacheGroupManager.prototype.transferOwner=function(e){if(e.to){var t=this.get(e.to);t&&e.newOwner&&t.transferOwner(e.newOwner)}},YYIMCacheGroupManager.prototype.inviteGroupMember=function(e){var t=this;YYIMChat.inviteGroupMember({to:e.to||e.id,members:e.members||[],success:function(s){t.updateCache(s),e.success&&e.success(s)},complete:function(){e.complete&&e.complete()}})},YYIMCacheGroupManager.prototype.modifyChatGroupInfo=function(e){if(this.get(e.to).owner.id===YYIMChat.getUserID()){var t=this;YYIMChat.modifyChatGroupInfo({to:e.to||e.id,name:e.name,success:function(s){t.updateCache(s),e.success&&e.success(s)},complete:function(){e.complete&&e.complete()}})}},YYIMCacheGroupManager.prototype.KickedOutByGroup=function(e){e.to===YYIMChat.getUserID()&&this.remove(e.from)},YYIMCacheGroupManager.prototype.exitChatGroup=function(e){var t=this;YYIMChat.exitChatGroup({to:e.to,success:function(e){t.remove(e.from)},complete:function(){e.complete&&e.complete()}})},YYIMCacheGroupManager.prototype.collectGroup=function(e){var t=this;YYIMChat.collectGroup({to:e.to,success:function(e){t.updateCache({id:e.from,collected:1})},complete:function(){e.complete&&e.complete()}})},YYIMCacheGroupManager.prototype.removeCollectGroup=function(e){var t=this;YYIMChat.removeCollectGroup({to:e.to,success:function(e){t.updateCache({id:e.from,collected:0})},complete:function(){e.complete&&e.complete()}})},YYIMCacheGroupMember.prototype.build=function(e){this.id=e.id||this.id,this.name=e.name||this.name,this.photo=e.photo||this.photo,this.affiliation=e.affiliation||this.affiliation,this.role=e.role||this.role,this.init()},YYIMCacheGroupMember.prototype.init=function(){this.syncInfo()},YYIMCacheGroupMember.prototype.syncInfo=function(){this.photo||(this.photo=YYIMCacheConfig.DEFAULT_PHOTO.GROUPMEMEBER)},YYIMCacheGroupMember.prototype.getPhotoUrl=function(){return YYIMChat.getFileUrl(this.photo)},YYIMCachePubAccount.prototype.init=function(){this.syncInfo(),this.getPubaccountType()},YYIMCachePubAccount.prototype.build=function(e){this.id=e.id||this.id,this.name=e.name||this.name,this.type=e.type||this.type||YYIMCacheConfig.PUBACCOUNT_TYPE.BROADCASE.TYPE,this.photo=e.photo||this.photo,this.init()},YYIMCachePubAccount.prototype.syncInfo=function(){this.photo||(this.photo=YYIMCacheConfig.DEFAULT_PHOTO.PUBACCOUNT)},YYIMCachePubAccount.prototype.getPhotoUrl=function(){return YYIMChat.getFileUrl(this.photo)},YYIMCachePubAccount.prototype.getPubaccountType=function(){if(!this.pubaccountType)switch(this.type){case YYIMCacheConfig.PUBACCOUNT_TYPE.BROADCASE.TYPE:this.pubaccountType=YYIMCacheConfig.PUBACCOUNT_TYPE.BROADCASE.NAME;break;case YYIMCacheConfig.PUBACCOUNT_TYPE.SUBSCRIBED.TYPE:case YYIMCacheConfig.PUBACCOUNT_TYPE.SUBSCRIBE.TYPE:this.pubaccountType=YYIMCacheConfig.PUBACCOUNT_TYPE.SUBSCRIBE.NAME}return this.pubaccountType},YYIMCachePubAccountManager.prototype=new YYIMCacheList,YYIMCachePubAccountManager.getInstance=function(){return this._instance||(this._instance=new YYIMCachePubAccountManager),this._instance},YYIMCachePubAccountManager.prototype.updateCache=function(e){if(e&&e.id){var t=this.get(e.id);return t?t.build(e):(t=new YYIMCachePubAccount(e),this.set(t.id,t)),t}},YYIMCachePubAccountManager.prototype.queryPubaccount=function(e){YYIMChat.queryPubaccount(e)},YYIMCachePubAccountManager.prototype.addPubaccount=function(e){if(e&&e.id){var t=this.get(e.id);t||YYIMChat.addPubaccount(e)}},YYIMCachePubAccountManager.prototype.removePubaccount=function(e){if(e&&e.id){var t=this.get(e.id);if(t){var s=this;YYIMChat.removePubaccount({id:e.id,success:function(t){s.remove(t.from),e.success&&e.success(t)},error:function(){e.error&&e.error()},complete:function(){e.complete&&e.complete()}})}}},YYIMCachePubAccountManager.prototype.getPubaccountList=function(e){var t=this.get(),s=[];for(var i in t)"undefined"!=typeof e?t[i].pubaccountType===e&&s.push(t[i]):s.push(t[i]);return s};var YYIMCacheConfig={SERVICE_ADDRESS:"",REST_SERVLET:{VCARD:"service/member/interex/",SEARCH:"service/member/inters/param/"},PRE_HISTORY_LENGTH:10,BUSINESS:["business.worktime.yonyou","im.yyuap.com"],CHAT_TYPE:{CHAT:"chat",GROUP_CHAT:"groupchat",PUB_ACCOUNT:"pubaccount"},SEND_STATE:{NONE:"none",UNREADED:"unreaded",READED:"readed"},ROSTER_TYPE:{MYSELF:"myself",FRIEND:"friend",ASK:"ask",RECV:"recv",NONE:"none"},ROSTER_SUBSCRIPTION_TYPE:{BOTH:"both",NONE:"none"},PUBACCOUNT_TYPE:{SUBSCRIBED:{TYPE:1,NAME:"subscribed"},SUBSCRIBE:{TYPE:1,NAME:"subscribe"},BROADCASE:{TYPE:2,NAME:"broadcase"}},MESSAGE_CONTENT_TYPE:{MIXED:"mixed",SIMPLE:"simple",TEXT:2,FILE:4,IMAGE:8,SYSTEM:16,PUBLIC:32,AUDO:64,LOCATION:128,SHARE:256},DEFAULT_PHOTO:{DEFAULT:"",ROSTER:"",GROUP:"",GROUPMEMEBER:"",PUBACCOUNT:""},PRESENCE_SHOW:{CHAT:"chat",AWAY:"away",XA:"xa",DND:"dnd",UNAVAILABLE:"unavailable"},TERMINAL_TYPE:{WEB:"web",ANDROID:"android",IOS:"ios",PC:"pc"},MESSAGE_READ_TYPE:{READED:"readed",UNREADED:"unreaded",ALL:"all"}},BusinessConfig={TYPE:{approval:"审批",agenda:"日程",project:"项目",task:"任务",conference:"会议"},TYPEPREFIX:{_approval_:"审批",_agenda_:"日程",_project_:"项目",_conference_:"会议"}};YYIMCacheList.prototype.set=function(e,t){e&&t&&(this.list[e]=t)},YYIMCacheList.prototype.get=function(e){return e?this.list[e]:this.list},YYIMCacheList.prototype.remove=function(e){e&&delete this.list[e]},YYIMCacheList.prototype.update=function(e,t){this.set.apply(this,arguments)},YYIMCacheList.prototype.clear=function(){this.list={}},YYIMCacheMessage.prototype.init=function(){this.syncInfo()},YYIMCacheMessage.prototype.build=function(e){this.id=e.msgId||e.packetId||e.id||this.id,this.type=e.type||e.chatType||this.type||YYIMCacheConfig.CHAT_TYPE.CHAT,this.data=e.body||e.data||this.data,this.resource=e.resource||this.resource,this.readed=!!e.readed||this.readed||!1,this.received=!!this.received||!1,this.dateline=e.dateline||this.data.dateline,this.received||this.sendState===YYIMCacheConfig.SEND_STATE.READED||this.type!==YYIMCacheConfig.CHAT_TYPE.CHAT||(this.sendState=e.sendState||this.sendState||YYIMCacheConfig.SEND_STATE.NONE),this.from||(this.fromId=e.from||e.fromId),this.to||(this.toId=e.to||e.toId),this.init()},YYIMCacheMessage.prototype.syncInfo=function(){this.data.dateline=this.dateline;var e,t,s;if(s=t=e=YYIMCacheRosterManager.getInstance(),this.toId===YYIMChat.getUserID()&&(this.received=!0),this.type===YYIMCacheConfig.CHAT_TYPE.PUB_ACCOUNT)this.received?e=YYIMCachePubAccountManager.getInstance():t=YYIMCachePubAccountManager.getInstance();else if(this.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT){if(this.received?e=YYIMCacheGroupManager.getInstance():t=YYIMCacheGroupManager.getInstance(),this.fromId){this.fromRosterId=this.fromId.roster;var i=this.fromId.room;this.fromId=i,this.fromRosterId===YYIMChat.getUserID()&&(this.received=!1)}this.fromRoster&&this.fromRoster.id===YYIMChat.getUserID()&&(this.received=!1)}if(this.fromId){var a=this.type===YYIMCacheConfig.CHAT_TYPE.CHAT?e.updateCache({id:this.fromId}):e.get(this.fromId);a&&(this.from=a,delete this.fromId)}if(this.toId){var o=this.type===YYIMCacheConfig.CHAT_TYPE.CHAT?t.updateCache({id:this.toId}):t.get(this.toId);o&&(this.to=o,delete this.toId)}if(this.fromRosterId){var n=s.updateCache({id:this.fromRosterId});n&&(this.fromRoster=n,delete this.fromRosterId)}this.opposite=this.fromId||this.from.id;var r=this.toId||this.to.id;YYIMChat.getUserID()!==r&&(this.opposite=r),this.getTemplateCode(),this.analysisBusiness()},YYIMCacheMessage.prototype.getTemplateCode=function(){!this.templateCode&&this.data&&(this.templateCode=this.data.contentType)},YYIMCacheMessage.prototype.analysisBusiness=function(){if(this.data&&!this.business&&YYIMCacheConfig.BUSINESS.indexOf(this.data.extend)>-1){this.business=!0;try{this.data.content=JSON.parse(this.data.content)}catch(e){}this.data.content.businessType=BusinessConfig.TYPE[this.data.content.businessType||""]||this.data.content.businessType}},YYIMCacheMessageManager.prototype=new YYIMCacheList,YYIMCacheMessageManager.getInstance=function(){return this._instance||(this._instance=new YYIMCacheMessageManager),this._instance},YYIMCacheMessageManager.prototype.updateCache=function(e){if(e){var t=e.msgId||e.packetId||e.id;if(t){var s=this.get(t),i=!1;if(s)s.build(e);else{if(s=new YYIMCacheMessage(e),!s.data)return;this.set(t,s),i=!0}try{var a=s.fromId||s.from.id,o=s.toId||s.to.id}catch(n){return}if(YYIMChat.getUserID()!==o&&(a=o),a){this.messList[a]||(this.messList[a]={},this.messList[a].readed=[],this.messList[a].unreaded=[],this.messList[a].all=[]),i&&this.messList[a].all.push(s),this.messList[a].readed.length=0,this.messList[a].unreaded.length=0,this.unReadedNum=0,this.readedNum=0;for(var r in this.messList[a].all){var c=this.messList[a].all[r];c&&c.readed===!0?(this.messList[a].readed.push(c),this.readedNum++):c&&c.readed===!1&&(this.messList[a].unreaded.push(c),this.unReadedNum++)}this.messList[a].readed=this.messList[a].readed.sort(YYIMUtil.array.comparisonAsc("dateline")),this.messList[a].unreaded=this.messList[a].unreaded.sort(YYIMUtil.array.comparisonAsc("dateline")),this.messList[a].all=this.messList[a].all.sort(YYIMUtil.array.comparisonAsc("dateline"))}return s}}},YYIMCacheMessageManager.prototype.getHistoryMessage=function(e){var t=e.id||e.to;if(t){var s=this;return s.history=s.history||{},s.history[t]=s.history[t]||{},s.history[t].start=s.history[t].start||0,s.history[t].present=e.present||s.history[t].present||0,s.history[t].isEnd?void(e.success&&e.success({count:0,isEnd:!0})):void YYIMChat.getHistoryMessage({id:t,chatType:e.chatType||e.type||YYIMCacheConfig.CHAT_TYPE.CHAT,contentType:e.contentType,start:s.history[t].start||0,num:YYIMCacheConfig.PRE_HISTORY_LENGTH,success:function(i){var a=i.result.length<=YYIMCacheConfig.PRE_HISTORY_LENGTH-s.history[t].present&&i.result.length<YYIMCacheConfig.PRE_HISTORY_LENGTH,o=!1,n=null;for(var r in i.result){var c=i.result[r],h=c.msgId||c.packetId||c.id,Y=s.get(h);if(Y||(c.readed=!0,n=s.updateCache(c),s.history[t].present+=1),s.history[t].start+=1,s.history[t].present>=YYIMCacheConfig.PRE_HISTORY_LENGTH){o=!0;break}}if(a||o){var u=s.history[t].present;s.history[t].present=0,a&&(s.history[t].isEnd=!0),n&&YYIMCacheRecentManager.getInstance().updateCache({id:t,dateline:n.dateline,latestState:n.data.content,contentType:n.data.contentType,type:n.type,sort:!1}),e.success&&e.success({count:u,isEnd:a,isFull:o})}else s.getHistoryMessage(e)},error:function(){e.error&&e.error()},complete:function(){e.complete&&e.complete()}})}},YYIMCacheMessageManager.prototype.getOfflineMessage=function(){YYIMChat.getOfflineMessage()},YYIMCacheMessageManager.prototype.getMessageList=function(e){try{return this.messList[e.id][e.condition||"all"]}catch(t){return[]}},YYIMCacheMessageManager.prototype.showMessageList=function(e){var t=this.getMessageList(e);if("all"===e.condition)for(var s in t)t[s].data&&!t[s].readed&&this.sendReceipts(t[s].data.receipt);return t},YYIMCacheMessageManager.prototype.turnToReaded=function(e){},YYIMCacheMessageManager.prototype.sendReceipts=function(e){if(e&&e.id&&e.to){YYIMChat.sendReceiptsPacket(e),YYIMChat.sendReadedReceiptsPacket(e);var t=this.get(e.id);t&&this.updateCache({id:e.id,readed:!0})}},YYIMCacheMessageManager.prototype.sendTextMessage=function(e){var t=this,s=e.type||YYIMCacheConfig.CHAT_TYPE.CHAT,i=e.to||e.id;YYIMChat.sendTextMessage({to:i,type:s,msg:e.msg,style:e.style,extend:e.extend,success:function(i){if(i.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT)return void(e.success&&e.success(i));i.type=s,i.readed=!0,i.sendState=YYIMCacheConfig.SEND_STATE.UNREADED;var a=t.updateCache(i);e.success&&e.success(a)}})},YYIMCacheMessageManager.prototype.sendShareMessage=function(e){var t=this,s=e.type||YYIMCacheConfig.CHAT_TYPE.CHAT;e.to||e.id;YYIMChat.sendShareMessage({to:e.to||e.id,type:s,sharebody:e.sharebody,extend:e.extend,success:function(i){if(i.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT)return void(e.success&&e.success(i));i.type=s,i.readed=!0,i.sendState=YYIMCacheConfig.SEND_STATE.UNREADED;var a=t.updateCache(i);e.success&&e.success(a)}})},YYIMCacheMessageManager.prototype.sendPicMessage=function(e){var t=this,s=e.type||YYIMCacheConfig.CHAT_TYPE.CHAT;e.to||e.id;YYIMChat.sendPic({to:e.to||e.id,fileInputId:e.fileInputId,type:s,success:function(i){if(i.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT)return void(e.success&&e.success(i));i.type=s,i.readed=!0,i.sendState=YYIMCacheConfig.SEND_STATE.UNREADED;var a=t.updateCache(i);e.success&&e.success(a)}})},YYIMCacheMessageManager.prototype.sendFileMessage=function(e){var t=this,s=e.type||YYIMCacheConfig.CHAT_TYPE.CHAT;e.to||e.id;YYIMChat.sendFile({to:e.to||e.id,fileInputId:e.fileInputId,type:s,success:function(i){if(i.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT)return void(e.success&&e.success(i));i.type=s,i.readed=!0,i.sendState=YYIMCacheConfig.SEND_STATE.UNREADED;var a=t.updateCache(i);e.success&&e.success(a)}})},YYIMCacheMessageManager.prototype.sendWhiteBoardMessage=function(e){var t=this,s=e.type||YYIMCacheConfig.CHAT_TYPE.CHAT,i=e.to||e.id;YYIMChat.sendWhiteBoardMessage({to:i,type:s,extend:e.extend,content:e.content,success:function(i){if(i.type===YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT)return void(e.success&&e.success(i));i.type=s,i.readed=!0,i.sendState=YYIMCacheConfig.SEND_STATE.UNREADED;var a=t.updateCache(i);e.success&&e.success(a)}})},YYIMCacheMessageManager.prototype.listen=function(e,t){if(arguments.length)e&&"function"==typeof t&&(this.listenList=this.listenList||{},this.listenList[e]=t);else if(this.listenList)for(var s in this.listenList){var i=this.listenList[s];try{i()}catch(a){delete this.listenList[s]}}},YYIMCachePresence.prototype.build=function(e){if(e.show&&e.resource)for(var t in YYIMCacheConfig.TERMINAL_TYPE)if(-1!==e.resource.toLowerCase().indexOf(YYIMCacheConfig.TERMINAL_TYPE[t])){this.presence[YYIMCacheConfig.TERMINAL_TYPE[t]]={show:e.show,resource:e.resource};break}},YYIMCacheRoster.prototype.build=function(e){this.id=e.id||this.id,this.name=e.name||e.nickname||this.name,this.ask=e.ask||this.ask,this.recv=e.recv||this.recv,this.resource=e.resource||this.resource,this.subscription=e.subscription||this.subscription,this.group=e.group||this.group,this.photo=e.photo||this.photo,this.init()},YYIMCacheRoster.prototype.init=function(){this.initVCard(),this.getRosterType(),this.syncInfo(),this.updatePresence()},YYIMCacheRoster.prototype.updatePresence=function(e){e=e||{},e.id=this.id,e.resource=e.resource||this.resource,e.show=e.show||YYIMCacheConfig.PRESENCE_SHOW.UNAVAILABLE,this.presence?this.presence.build(e):this.presence=new YYIMCachePresence(e)},YYIMCacheRoster.prototype.getPresence=function(e){var t=this.presence.presence[e||YYIMCacheConfig.TERMINAL_TYPE.WEB];return t?t.show:void 0},YYIMCacheRoster.prototype.setVCard=function(e){if(this.rosterType===YYIMCacheConfig.ROSTER_TYPE.MYSELF&&e.vcard){var t=this;YYIMChat.setVCard({vcard:e.vcard,success:function(){t.vcard.build(e.vcard),t.syncInfo(),e.success&&e.success()},error:function(){e.error&&e.error()}})}},YYIMCacheRoster.prototype.setRemark=function(e){if(this.rosterType===YYIMCacheConfig.ROSTER_TYPE.FRIEND&&e&&e.roster&&(e.roster.name!==this.name||e.roster.group!==this.group)){var t=this;YYIMChat.updateRosterItem({roster:{id:this.id,name:e.roster.name,groups:e.roster.group},suceess:function(){t.build({name:e.roster.name,group:e.roster.group}),e.success&&e.success()},error:function(){e.error&&e.error()}})}},YYIMCacheRoster.prototype.initVCard=function(){var e=this;!this.vcard&&this.id&&(this.vcard=new YYIMCacheVCard({id:this.id,name:this.name||this.id,photo:this.photo}),YYIMCacheConfig.REST_SERVLET&&!YYIMCacheConfig.REST_SERVLET.VCARD?YYIMChat.getVCard({id:this.id,success:function(t){e.vcard.build(t),e.syncInfo()}}):jQuery.ajax({url:YYIMCacheConfig.SERVICE_ADDRESS+YYIMCacheConfig.REST_SERVLET.VCARD+this.id,type:"get",dataType:"json",cache:!1,async:!1,headers:{Authorization:YYIMUtil.cookie.get("authToken")},success:function(t){t&&t.success&&t.data&&(t.data.id=e.id,e.vcard.build(t.data),e.syncInfo())}}))},YYIMCacheRoster.prototype.syncInfo=function(){this.name&&this.name!=this.id&&this.rosterType!==YYIMCacheConfig.ROSTER_TYPE.MYSELF||!this.vcard||!this.vcard.name||(this.name=this.vcard.name),this.vcard&&this.vcard.photo&&(this.photo=this.vcard.photo),this.resource||(this.resource=YYIMChat.getUserResource()),this.photo||(this.photo=YYIMCacheConfig.DEFAULT_PHOTO.ROSTER)},YYIMCacheRoster.prototype.getPhotoUrl=function(){return YYIMChat.getFileUrl(this.photo)},YYIMCacheRoster.prototype.getRosterType=function(){return this.id===YYIMChat.getUserID()?this.rosterType=YYIMCacheConfig.ROSTER_TYPE.MYSELF:this.subscription===YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.BOTH?this.rosterType=YYIMCacheConfig.ROSTER_TYPE.FRIEND:this.subscription===YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.NONE&&1===this.ask?this.rosterType=YYIMCacheConfig.ROSTER_TYPE.ASK:this.subscription===YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.NONE&&1===this.recv?this.rosterType=YYIMCacheConfig.ROSTER_TYPE.RECV:this.rosterType=YYIMCacheConfig.ROSTER_TYPE.NONE,this.rosterType},YYIMCacheRosterManager.prototype=new YYIMCacheList,YYIMCacheRosterManager.getInstance=function(){return this._instance||(this._instance=new YYIMCacheRosterManager),this._instance},YYIMCacheRosterManager.prototype.init=function(){this.updateCache({id:YYIMChat.getUserID()}),this.getRostersPresence()},YYIMCacheRosterManager.prototype.updateCache=function(e){if(e&&e.id){var t=this.get(e.id);return t?t.build(e):(t=new YYIMCacheRoster(e),this.set(t.id,t)),t}},YYIMCacheRosterManager.prototype.addRoster=function(e){if(e){var t=this.get(e);t&&-1===this.getRostersList("none").indexOf(t)||(YYIMChat.addRosterItem(e),this.updateCache({id:e,ask:1,recv:-1,subscription:YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.NONE}))}},YYIMCacheRosterManager.prototype.deleteRoster=function(e){if(e&&-1!==this.getRostersList("friend").indexOf(this.get(e.id))){var t=this;YYIMChat.deleteRosterItem({id:e.id,success:function(){t.updateCache({id:e.id,ask:-1,recv:-1,subscription:YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.NONE}),e.success&&e.success()},complete:function(){e.complete&&e.complete()}})}},YYIMCacheRosterManager.prototype.approveRoster=function(e){e&&-1!==this.getRostersList("recv").indexOf(this.get(e))&&(YYIMChat.approveSubscribe(e),this.updateCache({id:e,ask:-1,recv:-1,subscription:YYIMCacheConfig.ROSTER_SUBSCRIPTION_TYPE.BOTH}))},YYIMCacheRosterManager.prototype.removeRoster=function(e){this.remove(e)},YYIMCacheRosterManager.prototype.updatePresence=function(e){if(e&&(e.from||e.id)){var t=this.get(e.from||e.id);t&&t.updatePresence(e)}},YYIMCacheRosterManager.prototype.getRostersPresence=function(){var e=this;setTimeout(function(){var t=Object.keys(e.list);YYIMChat.getRostersPresence({username:t,success:function(t){for(var s in t){var i=t[s].presence;for(var a in i)i[a].available&&e.updatePresence({id:t[s].userid,resource:i[a].device,show:i[a].show})}}})},500)},YYIMCacheRosterManager.prototype.setVCard=function(e){var t=this.get(YYIMChat.getUserID());t&&t.setVCard(e)},YYIMCacheRosterManager.prototype.setRemark=function(e){if(e&&e.roster&&e.roster.id){var t=this.get(e.roster.id);t&&t.setRemark(e)}},YYIMCacheRosterManager.prototype.getRostersList=function(e){var t=this.get(),s=[];for(var i in t)"undefined"!=typeof e?t[i].rosterType===e&&s.push(t[i]):s.push(t[i]);return s},YYIMCacheVCard.prototype.build=function(e){this.id=e.id||e.userId||this.id,this.mobile=e.mobile||this.mobile,this.name=e.name||e.nickname||this.name,this.photo=e.photo||this.photo,this.telephone=e.telephone||this.telephone,this.email=e.email||this.email,this.gender=e.gender||this.gender,this.location=e.location||this.location,this.position=e.position||this.position,this.six=e.six||this.six,this.office=e.office||this.office,this.officePhone=e.officePhone||this.officePhone,this.phoneticName=e.phoneticName||this.phoneticName},YYIMCacheRecent.prototype.build=function(e){this.id=e.id||this.id,this.name=e.name||this.name||this.id,this.dateline=e.dateline||this.dateline,this.type=e.type||this.type,this.latestState=e.latestState||this.latestState,this.contentType=e.contentType||this.contentType,this.syncInfo()},YYIMCacheRecent.prototype.syncInfo=function(){if(this.id)for(var e in BusinessConfig.TYPEPREFIX)if(this.id.toString().indexOf(e)>-1){this.businessType={key:e,value:BusinessConfig.TYPEPREFIX[e]};break}if(this.id&&!this.from)switch(this.type){case YYIMCacheConfig.CHAT_TYPE.CHAT:this.from=YYIMCacheRosterManager.getInstance().updateCache({id:this.id});break;case YYIMCacheConfig.CHAT_TYPE.GROUP_CHAT:this.from=YYIMCacheGroupManager.getInstance().get(this.id);break;case YYIMCacheConfig.CHAT_TYPE.PUB_ACCOUNT:this.from=YYIMCachePubAccountManager.getInstance().get(this.id)}if(this.from&&this.from.name!==this.from.id&&(this.name=this.from.name),this.latestState)switch(this.contentType){case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.FILE:this.latestState="文件消息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.IMAGE:this.latestState="图片消息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.SYSTEM:this.latestState="单图文消息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.PUBLIC:this.latestState="多图文消息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.AUDO:this.latestState="音频消息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.LOCATION:this.latestState="位置信息";break;case YYIMCacheConfig.MESSAGE_CONTENT_TYPE.SHARE:this.latestState="分享信息";break;default:this.latestState=this.latestState.messageText||this.latestState}},YYIMCacheRecentManager.prototype=new YYIMCacheList,YYIMCacheRecentManager.getInstance=function(){return this._instance||(this._instance=new YYIMCacheRecentManager),this._instance},YYIMCacheRecentManager.prototype.init=function(){if(this.id||(this.id=YYIMChat.getUserID()),this.id){var e=null;try{e=JSON.parse(this.getItem(this.id))}catch(t){}if(e&&e.length)for(var s in e)this.updateCache(e[s])}},YYIMCacheRecentManager.prototype.updateCache=function(e){if(this.id||(this.id=YYIMChat.getUserID()),e&&e.id){var t=this.get(e.id);return t?(t.build(e),e.sort&&this.recentList.indexOf(t)>-1&&0!=this.recentList.indexOf(t)&&(this.recentList.splice(this.recentList.indexOf(t),1),this.recentList.unshift(t))):(t=new YYIMCacheRecent(e),this.set(t.id,t),this.recentList.unshift(t)),this.save(),t}},YYIMCacheRecentManager.prototype.remove=function(e){if(e){var t=this.get(e);t&&(delete this.list[e],this.recentList.splice(this.recentList.indexOf(t),1),this.save())}},YYIMCacheRecentManager.prototype.save=function(){if(this.recentList.length){var e=[];for(var t in this.recentList)if(this.recentList[t].id){var s={id:this.recentList[t].id,name:this.recentList[t].name,dateline:this.recentList[t].dateline,latestState:this.recentList[t].latestState,type:this.recentList[t].type,contentType:this.recentList[t].contentType};e.unshift(s)}this.id&&this.setItem(this.id,JSON.stringify(e))}},YYIMCacheRecentManager.prototype.setItem=function(e,t){if(e&&t)try{window.localStorage.setItem(e,t)}catch(s){YYIMChat.log("浏览器不支持localStroage",0)}},YYIMCacheRecentManager.prototype.getItem=function(e){if(e)try{return window.localStorage.getItem(e)}catch(t){YYIMChat.log("浏览器不支持localStroage",0)}};